<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>রক্তদাতা অনুসন্ধান - পাশে আছি</title>
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

    <style>
        /* =========================================
           1. CORE STYLES
           ========================================= */
        :root {
            --primary: #e53935;
            --primary-dark: #c62828;
            --white: #fff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --text-color: #333;
            --text-light: #666;
            --header-bg: #fff;
            --card-bg: #fff;
            --footer-bg: #2c3e50;
            --sidebar-bg: rgba(255, 255, 255, 0.95);
            --sidebar-text: #333;
            --sidebar-hover-bg: #EEF2FF;
            --sidebar-hover-text: #151A2D;
            --section-bg: rgba(255, 255, 255, 0.65);
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --text-color: #f5f5f5;
            --text-light: #a0a0a0;
            --header-bg: #1e1e1e;
            --card-bg: #2a2a2a;
            --footer-bg: #1e1e1e;
            --sidebar-bg: rgba(30, 30, 30, 0.95);
            --sidebar-text: #f5f5f5;
            --sidebar-hover-bg: #333;
            --sidebar-hover-text: #f5f5f5;
            --shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
            --section-bg: rgba(42, 42, 42, 0.6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        
        @keyframes bgColorChange {
            0% { background-color: #ffebee; }
            50% { background-color: #e8f5e9; }
            100% { background-color: #ffebee; }
        }

        body { 
            background-color: #ffebee; 
            color: var(--text-color); 
            line-height: 1.6; 
            min-height: 100vh;
            animation: bgColorChange 8s infinite alternate ease-in-out;
        }
        
        body.dark-mode {
            animation: none;
            background-color: #121212;
        }

        /* =========================================
           2. SEARCH VIEW STYLES
           ========================================= */
        #search-view-section {
            display: block;
            position: relative;
            min-height: 100vh;
        }
        
        .search-view-content { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        
        .search-container { 
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px; 
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); 
            padding: 40px; 
            width: 100%; 
            max-width: 600px; 
            position: relative; 
            overflow: hidden; 
        }

        .search-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, var(--primary), var(--primary-dark)); }
        .search-title { text-align: center; margin-bottom: 30px; color: var(--text-color); font-size: 1.8rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .search-title i { color: var(--primary); }
        .search-form { display: flex; flex-direction: column; gap: 20px; }
        .search-form .form-group label { font-weight: 500; color: var(--text-color); display: flex; align-items: center; gap: 8px; }
        .search-form .form-group label i { color: var(--primary); width: 20px; }
        
        .form-control { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid rgba(0,0,0,0.1); 
            border-radius: 10px; 
            font-size: 1rem; 
            transition: var(--transition); 
            background-color: rgba(255,255,255,0.6); 
            color: var(--text-color); 
        }
        
        body.dark-mode .form-control { border-color: #444; background-color: rgba(0,0,0,0.5); }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.2); }
        .search-btn { background: var(--primary); color: var(--white); border: none; padding: 15px; border-radius: 10px; font-weight: 600; font-size: 1.1rem; cursor: pointer; transition: var(--transition); margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .search-btn:hover { background: var(--primary-dark); transform: translateY(-2px); }

        /* =========================================
           3. RESULTS VIEW STYLES
           ========================================= */
        #results-view-section { display: none; }

        header { background-color: var(--header-bg); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 999; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; gap: 10px; color: var(--primary); font-weight: 700; font-size: 1.5rem; text-decoration: none; }
        .logo img { height: 40px; } 
        .btn { padding: 10px 20px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: var(--transition); border: none; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-primary[disabled] { background: #ccc; cursor: not-allowed; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: var(--white); }

        /* Sidebar Styles */
        .sidebar-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; }
        .sidebar-backdrop.is-open { opacity: 1; pointer-events: auto; }
        
        .sidebar { position: fixed; top: 0; left: 0; z-index: 1001; width: 280px; height: 100vh; background: var(--sidebar-bg); backdrop-filter: blur(10px); transform: translateX(-100%); transition: transform 0.4s ease; display: flex; flex-direction: column; }
        .sidebar.is-open { transform: translateX(0); }
        
        .sidebar .sidebar-header { display: flex; padding: 20px; align-items: center; justify-content: space-between; flex-shrink: 0; }
        .sidebar-header .header-logo img { width: 46px; height: 46px; border-radius: 50%; }
        .sidebar-header .sidebar-back-button { height: 35px; width: 35px; color: var(--sidebar-text); border: none; cursor: pointer; display: flex; background: transparent; align-items: center; justify-content: center; border-radius: 8px; font-size: 1.5rem; transition: 0.4s ease; }
        .sidebar-header .sidebar-back-button:hover { background: rgba(0, 0, 0, 0.1); }
        
        .sidebar-nav { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; padding-bottom: 20px; }
        .nav-list { list-style: none; display: flex; flex-direction: column; gap: 5px; padding: 0 15px; }
        .nav-list.primary-nav { flex-grow: 1; }
        
        .nav-item .nav-link { color: var(--sidebar-text); display: flex; gap: 12px; border-radius: 8px; padding: 12px 15px; align-items: center; text-decoration: none; transition: 0.3s ease; font-weight: 500; }
        .sidebar-nav .nav-item:hover > .nav-link { color: var(--sidebar-hover-text); background: var(--sidebar-hover-bg); }
        
        .nav-list.secondary-nav { margin-top: auto; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); }
        body.dark-mode .nav-list.secondary-nav { border-top: 1px solid rgba(255,255,255,0.1); }
        
        #theme-toggle .dark-mode-icon { display: none; }
        body.dark-mode #theme-toggle .light-mode-icon { display: none; }
        body.dark-mode #theme-toggle .dark-mode-icon { display: block; }

        .sidebar-nav .nav-item { position: relative; }
        .sidebar-nav .dropdown-container .dropdown-icon { margin-left: auto; transition: transform 0.3s ease; }
        .sidebar-nav .dropdown-container.open .dropdown-icon { transform: rotate(180deg); }
        .sidebar-nav .dropdown-menu { list-style: none; padding-left: 20px; height: 0; overflow: hidden; transition: height 0.4s ease; display: flex; flex-direction: column; gap: 2px; }

        /* Results Grid */
        .section-title { color: var(--primary-dark); margin-bottom: 15px; font-size: 1.5rem; border-bottom: 2px solid var(--primary-dark); padding-bottom: 8px; font-weight: 600; }
        .emergency-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; width: 100%; margin-top: 20px; }
        
        .emergency-card { background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow); position: relative; border-left: 5px solid var(--primary); animation: fadeIn 0.5s ease; text-align: left; }
        .e-card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; position: relative; }
        .blood-group-badge { width: 45px; height: 45px; background: var(--primary); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; box-shadow: 0 2px 5px rgba(229, 57, 53, 0.4); }
        .creator-info { display: flex; flex-direction: column; margin-left: 10px; }
        .creator-name { font-size: 0.95rem; color: var(--text-color); font-weight: 600; }
        .e-card-tags { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; margin-left: auto; }
        .status-tag { font-size: 0.75rem; color: #27ae60; background: rgba(39, 174, 96, 0.1); padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .e-details h4 { font-size: 1.1rem; margin-bottom: 5px; color: var(--text-color); }
        .e-details p { font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .e-details i { color: var(--primary); width: 15px; }
        .e-actions { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        body.dark-mode .e-actions { border-top-color: #444; }
        .btn-sm { padding: 6px 15px; font-size: 0.85rem; border-radius: 20px; }
        .btn-call { background: #27ae60; color: white; border: none; cursor: pointer; }
        .btn-call:hover { background: #219150; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Footer */
        footer { background: var(--footer-bg); color: var(--white); padding: 60px 0 20px; margin-top: 40px; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-column h3 { font-size: 1.3rem; margin-bottom: 20px; position: relative; padding-bottom: 10px; }
        .footer-column h3::after { content: ''; position: absolute; bottom: 0; left: 0; width: 50px; height: 2px; background: var(--primary); }
        .footer-links { list-style: none; } .footer-links li { margin-bottom: 10px; } .footer-links a { color: #ddd; text-decoration: none; transition: var(--transition); }
        .footer-links a:hover { color: var(--primary); padding-left: 5px; }
        .social-links { display: flex; gap: 15px; margin-top: 20px; }
        .social-links a { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; color: var(--white); transition: var(--transition); }
        .social-links a:hover { background: var(--primary); transform: translateY(-3px); }
        .copyright { text-align: center; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9rem; color: #aaa; }

        /* Floating Action Button (FAB) */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .fab-hint {
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            margin-bottom: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease;
            pointer-events: none;
            position: relative;
        }
        
        .fab-hint.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .fab-hint::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 22px;
            width: 12px;
            height: 12px;
            background-color: var(--card-bg);
            transform: rotate(45deg);
        }

        .fab-btn {
            width: 60px;
            height: 60px;
            background-color: var(--primary);
            color: #fff;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .fab-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background-color: var(--primary-dark);
        }

        /* =========================================
           4. PASS KEY OVERLAY & ADD CONTACT OVERLAY STYLES
           ========================================= */
        .passkey-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* Transparent Black */
            backdrop-filter: blur(8px); /* Blur Effect */
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeInOverlay 0.4s ease;
            overflow-y: auto; /* For taller forms */
            padding: 20px;
        }
        
        .passkey-container {
            background-color: var(--card-bg);
            border-radius: 30px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            color: var(--text-color);
        }
        
        /* Add Contact Form Specific Styles within Overlay */
        .add-contact-container {
            background-color: var(--card-bg);
            border-radius: 30px;
            box-shadow: var(--shadow);
            padding: 30px;
            width: 100%;
            max-width: 800px;
            position: relative;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .passkey-container .close-btn, .add-contact-container .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 0;
            width: 35px;
            height: 35px;
            line-height: 35px;
            border-radius: 50%;
            font-size: 1.2rem;
            background: transparent;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            z-index: 10;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: var(--primary);
            background: rgba(0,0,0,0.05);
        }
        
        .passkey-title, .edit-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text-color);
            text-align: center;
        }
        
        #passkey-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            letter-spacing: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.02);
            color: var(--text-color);
        }
        
        #passkey-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.1);
        }
        
        #passkey-error {
            color: var(--primary);
            margin-top: 15px;
            font-weight: 500;
            height: 20px;
            min-height: 20px;
        }

        /* Form Grid for Add Contact */
        .edit-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; }
        .form-group.full-width { grid-column: 1 / -1; }
        .edit-form .form-group label { font-weight: 500; color: var(--text-color); display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        
        @media (max-width: 768px) { .edit-form { grid-template-columns: 1fr; } .form-group.full-width { grid-column: 1 / 1; } }

        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- =========================================
         VIEW 1: SEARCH PAGE
         ========================================= -->
    <div id="search-view-section">
        <div class="search-view-content">
            <div class="search-container">
                <h1 class="search-title" id="dynamicSearchTitle"><i class="fas fa-search"></i> রক্তদাতা সন্ধান</h1>
                
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label for="division"><i class="fas fa-map-marker-alt"></i>বিভাগ</label>
                        <select id="division" class="form-control" required>
                            <option value="" disabled selected>বিভাগ নির্বাচন করুন</option>
                            <!-- JS Will Populate (Bangla Names) -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="district"><i class="fas fa-map-marked-alt"></i>জেলা</label>
                        <select id="district" class="form-control" disabled required>
                            <option value="" disabled selected>প্রথমে বিভাগ নির্বাচন করুন</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="upazila"><i class="fas fa-location-arrow"></i>উপজেলা</label>
                        <select id="upazila" class="form-control" disabled required>
                            <option value="" disabled selected>প্রথমে জেলা নির্বাচন করুন</option>
                        </select>
                    </div>
                    <!-- Blood Group Option Removed Here -->
                    <button type="submit" class="search-btn"><i class="fas fa-search"></i> খুঁজুন</button>
                </form>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="index.html" style="color: var(--primary); text-decoration: none;"><i class="fas fa-arrow-left"></i> ফিরে যান</a>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================================
         VIEW 3: RESULTS PAGE
         ========================================= -->
    <div id="results-view-section">
        
        <!-- Sidebar and Backdrop -->
        <div class="sidebar-backdrop"></div>
        <aside class="sidebar">
            <header class="sidebar-header">
              <a href="index.html" class="header-logo">
                   <img src="https://i.ibb.co/QFtV51LQ/1000018745.png" alt="logo">
              </a>
              <button class="sidebar-back-button">
                <span class="material-symbols-rounded">arrow_back</span>
              </button>
            </header>
            
            <nav class="sidebar-nav">
              <ul class="nav-list primary-nav">
                <li class="nav-item"><a href="index.html" class="nav-link"><span class="material-symbols-rounded">home</span><span class="nav-label">হোম</span></a></li>
                <li class="nav-item dropdown-container">
                  <a href="#" class="nav-link dropdown-toggle">
                    <span class="material-symbols-rounded">medical_services</span>
                    <span class="nav-label">সেবাসমূহ</span>
                    <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
                  </a>
                  <!-- Full Menu Restored with Correct Links -->
                  <ul class="dropdown-menu">
                    <li class="nav-item"><a href="all-search.html?type=donor" class="nav-link"><span class="material-symbols-rounded">bloodtype</span><span class="nav-label">ব্লাড ডোনার</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=police" class="nav-link"><span class="material-symbols-rounded">local_police</span><span class="nav-label">পুলিশ স্টেশন</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=hospital" class="nav-link"><span class="material-symbols-rounded">health_and_safety</span><span class="nav-label">হাসপাতাল ও ডাক্তার</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=ambulance" class="nav-link"><span class="material-symbols-rounded">ambulance</span><span class="nav-label">এম্বুলেন্স</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=electricity" class="nav-link"><span class="material-symbols-rounded">electrical_services</span><span class="nav-label">বিদ্যুৎ জোনাল অফিস</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=fire" class="nav-link"><span class="material-symbols-rounded">fire_truck</span><span class="nav-label">ফায়ার সার্ভিস</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=gas" class="nav-link"><span class="material-symbols-rounded">gas_meter</span><span class="nav-label">গ্যাস ফিলিং স্টেশন</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=wasa" class="nav-link"><span class="material-symbols-rounded">water_drop</span><span class="nav-label">ওয়াসা</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=petrol" class="nav-link"><span class="material-symbols-rounded">local_gas_station</span><span class="nav-label">পেট্রোল পাম্প</span></a></li>
                    <li class="nav-item"><a href="all-search.html?type=govt" class="nav-link"><span class="material-symbols-rounded">account_balance</span><span class="nav-label">সরকারী কার্যালয়</span></a></li>
                  </ul>
                </li>
                <li class="nav-item"><a href="bloodrouls.html" class="nav-link"><span class="material-symbols-rounded">rule</span><span class="nav-label">রক্তদানের নিয়ম</span></a></li>
                <li class="nav-item"><a href="emergency-find-blood.html" class="nav-link"><span class="material-symbols-rounded">emergency</span><span class="nav-label">ইমারজেন্সি ব্লাড</span></a></li>
                <li class="nav-item"><a href="news.html" class="nav-link"><span class="material-symbols-rounded">campaign</span><span class="nav-label">নিউজ এন্ড আপডেটস</span></a></li>
                <li class="nav-item"><a href="https://wa.me/8801851956615" class="nav-link"><span class="material-symbols-rounded">contact_support</span><span class="nav-label">সাপোর্ট</span></a></li>
              </ul>
      
              <ul class="nav-list secondary-nav">
                <li class="nav-item">
                    <a href="#" class="nav-link" id="theme-toggle">
                        <span class="material-symbols-rounded light-mode-icon">light_mode</span>
                        <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
                        <span class="nav-label"></span>
                    </a>
                </li>
              </ul>
            </nav>
        </aside>

        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <a href="index.html" class="logo">
                        <img src="https://i.ibb.co/QFtV51LQ/1000018745.png" alt="Logo">
                        <span>পাশে আছি</span>
                    </a>
                    <div class="auth-buttons">
                        <button class="btn btn-primary" onclick="resetSearch()">নতুন সন্ধান</button>
                        <button class="btn btn-outline sidebar-toggle">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="container">
                <!-- Result Section -->
                <section class="section" style="background: var(--section-bg); padding: 25px; border-radius: 12px; backdrop-filter: blur(12px);">
                    <!-- Dynamic Header Title -->
                    <h2 class="section-title" id="resultHeaderTitle">ফলাফল</h2>
                    <p id="searchCriteriaText" style="color: var(--text-light); margin-bottom: 20px;">ফিল্টার অনুযায়ী ফলাফল দেখানো হচ্ছে...</p>
                    
                    <div id="resultsGrid" class="emergency-grid">
                        <!-- Cards will be injected here by JS -->
                    </div>

                    <div id="noResults" style="display:none; text-align: center; padding: 40px; color: var(--text-light);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>দুঃখিত, এই এলাকায় এই মুহূর্তে কোনো <span id="dynamicNoResultType">রক্তদাতা</span> পাওয়া যায়নি।</p>
                    </div>
                </section>
            </div>
        </main>

        <!-- Floating Action Button (Only in Results View) -->
        <div class="fab-container">
            <!-- New Hint Box -->
            <div class="fab-hint" id="fabHint">আপনি কি কোন কন্টাক্ট যুক্ত করতে চান?</div>
            <button class="fab-btn" id="adminFab">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-column"><h3>পাশে আছি</h3><p>জীবন বাঁচাতে রক্ত দিন। আমাদের প্ল্যাটফর্ম জরুরী অবস্থায় রক্তের প্রয়োজনীয়তা মেটাতে সাহায্য করে।</p><div class="social-links"><a href="https://www.facebook.com/profile.php?id=61583966346088"><i class="fab fa-facebook-f"></i></a><a href="phttps://x.com/PasheAachi"><i class="fab fa-twitter"></i></a><a href="https://www.instagram.com/pasheachhi?igsh=aGJyeHpmM3llazY5"><i class="fab fa-instagram"></i></a><a href="https://bd.linkedin.com/in/pashe-aachi-65b5a6392"><i class="fab fa-linkedin-in"></i></a></div></div>
                    <div class="footer-column"><h3>লিংকস</h3><ul class="footer-links"><li><a href="index.html">হোম</a></li><li><a href="emergency-find-blood.html">জরুরি যোগাযোগ</a></li><li><a href="emergency-find-blood.html">ইমারজেন্সি ব্লাড</a></li></ul></div>
                    <div class="footer-column"><h3>সহায়তা</h3><ul class="footer-links"><li><a href="https://wa.me/8801851956615">সাপোর্ট</a></li><li><a href="about-us.html">আমাদের সম্পর্কে</a></li><li><a href="condition.html">টার্মস এন্ড কন্ডিশন</a></li></ul></div>
                    <div class="footer-column"><h3>যোগাযোগ</h3><ul class="footer-links"><li><i class="fas fa-map-marker-alt"></i> ঢাকা, বাংলাদেশ</li><li><i class="fas fa-phone"></i> +880 1XXX-XXXXXX</li><li><i class="fas fa-envelope"></i> info@bloodlink.com</li></ul></div>
                </div>
                <div class="copyright"><p>&copy; ২০২৫ পাশে আছি. সকল অধিকার সংরক্ষিত।</p></div>
            </div>
        </footer>
    </div>

    <!-- Pass Key Overlay -->
    <div class="passkey-overlay" id="passkeyOverlay">
        <div class="passkey-container">
            <button id="closePasskeyBtn" class="close-btn" title="ফিরে যান"><i class="fas fa-times"></i></button>
            <h1 class="passkey-title">Pass Key দিন</h1>
            <p style="color: var(--text-light); margin-bottom: 20px;">প্রশাসক প্যানেলে প্রবেশের জন্য ৬-সংখ্যার key -টি লিখুন।</p>
            <form id="passkeyForm">
                <input type="password" id="passkey-input" maxlength="6" autocomplete="off" placeholder="______" required>
                <div id="passkey-error"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem;">প্রবেশ করুন</button>
                
                <p style="margin-top: 20px; font-size: 0.9rem; text-align: center;">
                    <a href="https://wa.me/message/JXOKUYORFYPUK1" target="_blank" style="color: var(--primary); text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;">
                        <i class="fab fa-whatsapp"></i> এডমিনের থেকে Pass key নিন
                    </a>
                </p>
            </form>
        </div>
    </div>

    <!-- NEW: Add Contact Overlay (Initially Hidden) -->
    <div class="passkey-overlay" id="addContactOverlay">
        <div class="add-contact-container">
            <button id="closeAddContactBtn" class="close-btn" title="বন্ধ করুন"><i class="fas fa-times"></i></button>
            <h1 class="edit-title"><i class="fas fa-plus-circle"></i> নতুন কন্টাক্ট যোগ করুন</h1>
            
            <form class="edit-form" id="editForm">
                <div class="form-group full-width">
                    <label for="serviceType">সেকশন</label>
                    <select id="serviceType" class="form-control" required>
                        <option value="" disabled>সেকশন নির্বাচন করুন</option>
                        <option value="রক্তদাতা অনুসন্ধান" selected>ব্লাড ডোনার</option>
                        <option value="পুলিশ স্টেশন">পুলিশ স্টেশন</option>
                        <option value="হাসপাতাল">হাসপাতাল ও ডাক্তার</option>
                        <option value="এম্বুলেন্স">এম্বুলেন্স</option>
                        <option value="ফায়ার সার্ভিস">ফায়ার সার্ভিস</option>
                    </select>
                </div>
                
                <!-- বিভাগ সিলেক্ট -->
                <div class="form-group">
                    <label for="editDivision">বিভাগ</label>
                    <select id="editDivision" class="form-control" required>
                        <option value="" disabled selected>বিভাগ নির্বাচন করুন</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editDistrict">জেলা</label>
                    <select id="editDistrict" class="form-control" disabled required>
                        <option value="" disabled selected>প্রথমে বিভাগ নির্বাচন করুন</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="editUpazila">উপজেলা</label>
                    <select id="editUpazila" class="form-control" disabled required>
                        <option value="" disabled selected>প্রথমে জেলা নির্বাচন করুন</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="personName">নাম (অপশনাল)</label>
                    <input type="text" id="personName" class="form-control" placeholder="এখানে লিখুন......">
                </div>
                <div class="form-group full-width">
                    <label for="officeName">পদ / অফিস নাম</label>
                    <input type="text" id="officeName" class="form-control" placeholder="এখানে লিখুন......." required>
                </div>
                <div class="form-group">
                    <label for="mobileNumber">মোবাইল নম্বর</label>
                    <input type="tel" id="mobileNumber" class="form-control" placeholder="01234567899">
                </div>
                <div class="form-group">
                    <label for="emailAddress">ই-মেল (অপশনাল)</label>
                    <input type="email" id="emailAddress" class="form-control" placeholder="pasheachhi@mail.com">
                    <p style="font-size: 0.8rem; margin-top: 5px;">▪️ মোবাইল নম্বর দিলে ই-মেল না দিলেও হবে।</p>
                </div>
                <div class="form-group full-width">
                    <button type="submit" id="saveBtn" class="btn btn-primary save-btn" disabled>সেভ করুন</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK Integration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBnKQr2k2ZWnPlEZiJtMDewv6z3Z7p3kiU",
            authDomain: "pacheacchi.firebaseapp.com",
            projectId: "pacheacchi",
            storageBucket: "pacheacchi.firebasestorage.app",
            messagingSenderId: "679996219070",
            appId: "1:679996219070:web:871b64fb4a5be296eac8ef",
            measurementId: "G-M34YKMYHQ8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Export db for use in the main script if needed, or put logic here
        // Currently keeping logic separate in script below to maintain structure
    </script>

    <!-- =========================================
         JAVASCRIPT LOGIC
         ========================================= -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. DYNAMIC HEADER TEXT BASED ON FILENAME OR QUERY PARAM
            function getPageTitle() {
                const params = new URLSearchParams(window.location.search);
                const type = params.get('type');
                
                const typeMap = {
                    "donor": "রক্তদাতা অনুসন্ধান",
                    "police": "পুলিশ স্টেশন",
                    "hospital": "হাসপাতাল ও ডাক্তার",
                    "ambulance": "এম্বুলেন্স",
                    "electricity": "বিদ্যুৎ জোনাল অফিস",
                    "fire": "ফায়ার সার্ভিস",
                    "gas": "গ্যাস ফিলিং স্টেশন",
                    "wasa": "ওয়াসা",
                    "petrol": "পেট্রোল পাম্প",
                    "govt": "সরকারী কার্যালয়"
                };

                if (type && typeMap[type]) {
                    return typeMap[type];
                }

                // Fallback to filename logic if no query param
                const path = window.location.pathname;
                const filename = path.split("/").pop().split(".")[0];
                const titleMap = {
                    "find_result": "রক্তদাতা অনুসন্ধান",
                    "blood_search": "ব্লাড ডোনার খুঁজুন",
                    "all-search": "অনুসন্ধান"
                };
                return titleMap[filename] || "অনুসন্ধান";
            }

            const headerTextVariable = getPageTitle(); 
            document.getElementById('dynamicSearchTitle').innerHTML = `<i class="fas fa-search"></i> ${headerTextVariable}`;

            // Global State for Search
            let currentSearchDiv = '';
            let currentSearchDist = '';
            let currentSearchUpa = '';
            let currentServiceTitle = headerTextVariable;

            // 2. LOCATION DATA 
            const locationData = {
            barishal: { name: "বরিশাল", districts: { barguna: { name: "বরগুনা", upazilas: ["আমতলী", "বামনা", "বরগুনা সদর", "বেতাগী", "পাথরঘাটা", "তালতলী"] }, barishal: { name: "বরিশাল", upazilas: ["আগৈলঝাড়া", "বাবুগঞ্জ", "বাকেরগঞ্জ", "বানারীপাড়া", "গৌরনদী", "হিজলা", "বরিশাল সদর", "মেহেন্দিগঞ্জ", "মুলাদী", "উজিরপুর"] }, bhola: { name: "ভোলা", upazilas: ["ভোলা সদর", "বোরহানউদ্দিন", "চরফ্যাশন", "দৌলতখান", "লালমোহন", "মনপুরা", "তজুমদ্দিন"] }, jhalokati: { name: "ঝালকাঠি", upazilas: ["ঝালকাঠি সদর", "কাঁঠালিয়া", "নলছিটি", "রাজাপুর"] }, patuakhali: { name: "পটুয়াখালী", upazilas: ["বাউফল", "দশমিনা", "গলাচিপা", "কলাপাড়া", "মির্জাগঞ্জ", "পটুয়াখালী সদর", "দুমকি", "রাঙ্গাবালী"] }, pirojpur: { name: "পিরোজপুর", upazilas: ["ভান্ডারিয়া", "কাউখালী", "মঠবাড়িয়া", "নাজিরপুর", "পিরোজপুর সদর", "নেছারাবাদ", "ইন্দুরকানী"] } } },
            chattogram: { name: "চট্টগ্রাম", districts: { bandarban: { name: "বান্দরবান", upazilas: ["আলীকদম", "থানচি", "নাইক্ষ্যংছড়ি", "বান্দরবান সদর", "রুমা", "রোয়াংছড়ি", "লামা"] }, brahmanbaria: { name: "ব্রাহ্মণবাড়িয়া", upazilas: ["আখাউড়া", "আশুগঞ্জ", "বাঞ্ছারামপুর", "বিজয়নগর", "ব্রাহ্মণবাড়িয়া সদর", "কসবা", "নবীনগর", "নাসিরনগর", "সরাইল"] }, chandpur: { name: "চাঁদপুর", upazilas: ["চাঁদপুর সদর", "ফরিদগঞ্জ", "হাইমচর", "হাজীগঞ্জ", "কচুয়া", "মতলব উত্তর", "মতলব দক্ষিণ", "শাহরাস্তি"] }, chattogram: { name: "চট্টগ্রাম", upazilas: ["আনোয়ারা", "বাঁশখালী", "বোয়ালখালী", "চন্দনাইশ", "ফটিকছড়ি", "হাটহাজারী", "কর্ণফুলী", "লোহাগাড়া", "মীরসরাই", "পটিয়া", "রাঙ্গুনিয়া", "রাউজান", "সন্দ্বীপ", "সাতকানিয়া", "সীতাকুণ্ড", "আগ্রাবাদ", "কোতয়ালী", "চট্টগ্রাম সদর"] }, cumilla: { name: "কুমিল্লা", upazilas: ["বরুড়া", "ব্রাহ্মণপাড়া", "বুড়িচং", "চান্দিনা", "চৌদ্দগ্রাম", "দাউদকান্দি", "দেবিদ্বার", "হোমনা", "লাকসাম", "লালমাই", "মনোহরগঞ্জ", "মেঘনা", "মুরাদনগর", "নাঙ্গলকোট", "কুমিল্লা সদর", "কুমিল্লা সদর দক্ষিণ", "তিতাস"] }, coxsbazar: { name: "কক্সবাজার", upazilas: ["চকরিয়া", "কক্সবাজার সদর", "কুতুবদিয়া", "মহেশখালী", "পেকুয়া", "রামু", "টেকনাফ", "উখিয়া", "ঈদগাঁও"] }, feni: { name: "ফেনী", upazilas: ["ছাগলনাইয়া", "দাগনভূঞা", "ফেনী সদর", "পরশুরাম", "সোনাগাজী", "ফুলগাজী"] }, khagrachhari: { name: "খাগড়াছড়ি", upazilas: ["দীঘিনালা", "খাগড়াছড়ি সদর", "লক্ষ্মীছড়ি", "মহালছড়ি", "মানিকছড়ি", "মাটিরাঙ্গা", "পানছড়ি", "রামগড়", "গুইমারা"] }, lakshmipur: { name: "লক্ষ্মীপুর", upazilas: ["লক্ষ্মীপুর সদর", "রায়পুর", "রামগঞ্জ", "রামগতি", "কমলনগর"] }, noakhali: { name: "নোয়াখালী", upazilas: ["বেগমগঞ্জ", "চাটখিল", "কোম্পানীগঞ্জ", "হাতিয়া", "সেনবাগ", "সুবর্ণচর", "সোনাইমুড়ী", "কবিরহাট", "নোয়াখালী সদর"] }, rangamati: { name: "রাঙ্গামাটি", upazilas: ["বাঘাইছড়ি", "বরকল", "নানিয়ারচর", "কাপ্তাই", "কাউখালী", "লংগদু", "রাঙ্গামাটি সদর", "রাজস্থলী", "বিলাইছড়ি", "জুরাছড়ি"] } } },
            dhaka: { name: "ঢাকা", districts: { dhaka: { name: "ঢাকা", upazilas: ["সাভার", "ধামরাই", "কেরানীগঞ্জ", "নবাবগঞ্জ", "দোহার"] }, faridpur: { name: "ফরিদপুর", upazilas: ["ফরিদপুর সদর", "আলফাডাঙ্গা", "বোয়ালমারী", "মধুখালী", "নগরকান্দা", "সালথা", "ভাঙ্গা", "চরভদ্রাসন", "সদরপুর"] }, gazipur: { name: "গাজীপুর", upazilas: ["গাজীপুর সদর", "কালিয়াকৈর", "কালীগঞ্জ", "কাপাসিয়া", "শ্রীপুর"] }, gopalganj: { name: "গোপালগঞ্জ", upazilas: ["গোপালগঞ্জ সদর", "কাশিয়ানী", "কোটালীপাড়া", "মুকসুদপুর", "টুঙ্গিপাড়া"] }, kishoreganj: { name: "কিশোরগঞ্জ", upazilas: ["অষ্টগ্রাম", "বাজিতপুর", "ভৈরব", "হোসেনপুর", "ইটনা", "করিমগঞ্জ", "কটিয়াদী", "কিশোরগঞ্জ সদর", "কুলিয়ারচর", "মিঠামইন", "নিকলী", "পাকুন্দিয়া", "তাড়াইল"] }, madaripur: { name: "মাদারীপুর", upazilas: ["কালকিনি", "মাদারীপুর সদর", "রাজৈর", "শিবচর", "ডাসার"] }, manikganj: { name: "মানিকগঞ্জ", upazilas: ["দৌলতপুর", "ঘিওর", "হরিরামপুর", "মানিকগঞ্জ সদর", "সাটুরia", "শিবালয়", "সিঙ্গাইর"] }, munshiganj: { name: "মুন্সিগঞ্জ", upazilas: ["গজারিয়া", "লৌহজং", "মুন্সিগঞ্জ সদর", "সিরাজদিখান", "শ্রীনগর", "টঙ্গিবাড়ী"] }, narayanganj: { name: "নারায়ণগঞ্জ", upazilas: ["আড়াইহাজার", "বন্দর", "নারায়ণগঞ্জ সদর", "রূপগঞ্জ", "সোনারগাঁও"] }, narsingdi: { name: "নরসিংদী", upazilas: ["বেলাবো", "মনোহরদী", "নরসিংদী সদর", "পলাশ", "রায়পুরা", "শিবপুর"] }, rajbari: { name: "রাজবাড়ী", upazilas: ["বালিয়াকান্দি", "গোয়ালন্দ", "পাংশা", "কালুখালী", "রাজবাড়ী সদর"] }, shariatpur: { name: "শরীয়তপুর", upazilas: ["ভেদরগঞ্জ", "ডামুড্যা", "গোসাইরহাট", "নড়িয়া", "শরীয়তপুর সদর", "জাজিরা"] }, tangail: { name: "টাঙ্গাইল", upazilas: ["বাসাইল", "ভুঞাপুর", "দেলদুয়ার", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর", "নাগরপুর", "সখিপুর", "টাঙ্গাইল সদর", "ধনবাড়ী"] } } },
            khulna: { name: "খুলনা", districts: { bagerhat: { name: "বাগেরহাট", upazilas: ["বাগেরহাট সদর", "চিতলমারী", "ফকিরহাট", "কচুয়া", "মোল্লাহাট", "মোংলা", "মোরেলগঞ্জ", "রামপাল", "শরণখোলা"] }, chuadanga: { name: "চুয়াডাঙ্গা", upazilas: ["আলমডাঙ্গা", "চুয়াডাঙ্গা সদর", "দামুড়হুদা", "জীবননগর"] }, jashore: { name: "যশোর", upazilas: ["অভয়নগর", "বাঘারপাড়া", "চৌগাছা", "ঝিকরগাছা", "কেশবপুর", "যশোর সদর", "মণিরামপুর", "শার্শা"] }, jhenaidah: { name: "ঝিনাইদহ", upazilas: ["হরিণাকুণ্ডু", "ঝিনাইদহ সদর", "কালীগঞ্জ", "কোটচাঁদপুর", "মহেশপুর", "শৈলকুপা"] }, khulna: { name: "খুলনা", upazilas: ["বটিয়াঘাটা", "দাকোপ", "ডুমুরia", "দিঘলিয়া", "কয়রা", "পাইকগাছা", "ফুলতলা", "রূপসা", "তেরখাদা", "নিউমার্কেট", "সোনাডাঙ্গা"] }, kushtia: { name: "কুষ্টিয়া", upazilas: ["ভেড়ামারা", "দৌলতপুর", "খোকসা", "কুমারখালী", "কুষ্টিয়া সদর", "মিরপুর"] }, magura: { name: "মাগুরা", upazilas: ["মাগুরা সদর", "মহম্মদপুর", "শালিখা", "শ্রীপুর"] }, meherpur: { name: "মেহেরপুর", upazilas: ["গাংনী", "মেহেরপুর সদর", "মুজিবনগর"] }, narail: { name: "নড়াইল", upazilas: ["কালিয়া", "লোহাগড়া", "নড়াইল সদর"] }, satkhira: { name: "সাতক্ষীরা", upazilas: ["آশাশুনি", "দেবহাটা", "কলারোয়া", "কালীগঞ্জ", "সাতক্ষীরা সদর", "শ্যামনগর", "তালা"] } } },
            mymensingh: { name: "ময়মনসিংহ", districts: { jamalpur: { name: "জামালপুর", upazilas: ["বকশীগঞ্জ", "দেওয়ানগঞ্জ", "ইসলামপুর", "জামালপুর সদর", "মাদারগঞ্জ", "মেলান্দহ", "সরিষাবাড়ী"] }, mymensingh: { name: "ময়মনসিংহ", upazilas: ["ভালুকা", " ত্রিশাল", "হালুয়াঘাট", "মুক্তাগাছা", "ধোবাউড়া", "ফুলবাড়ীয়া", "গফরগাঁও", "গৌরীপুর", "ঈশ্বরগঞ্জ", "ময়মনসিংহ সদর", "নান্দাইল", "ফুলপুর", "তারাকান্দা"] }, netrokona: { name: "নেত্রকোণা", upazilas: ["আটপাড়া", "বারহাট্টা", "দুর্গাপুর", "খালিয়াজুরী", "কলমাকান্দা", "কেন্দুয়া", "মদন", "মোহনগঞ্জ", "নেত্রকোণা সদর", "পূর্বধলা"] }, sherpur: { name: "শেরপুর", upazilas: ["ঝিনাইগাতী", "নকলা", "নালিতাবাড়ী", "শেরপুর সদর", "শ্রীবরদী"] } } },
            rajshahi: { name: "রাজশাহী", districts: { bogura: { name: "বগুড়া", upazilas: ["আদমদীঘি", "বগুড়া সদর", "ধুনট", "দুপচাঁচিয়া", "গাবতলী", "কাহালু", "নন্দীগ্রাম", "সারিয়াকান্দি", "শাজাহানপুর", "শেরপুর", "শিবগঞ্জ", "সোনাতলা"] }, chapainawabganj: { name: "চাঁপাইনবাবগঞ্জ", upazilas: ["ভোলাহাট", "গোমস্তাপুর", "নাচোল", "নবাবগঞ্জ সদর", "শিবগঞ্জ"] }, joypurhat: { name: "জয়পুরহাট", upazilas: ["আক্কেলপুর", "জয়পুরহাট সদর", "কালাই", "ক্ষেতলাল", "পাঁচবিবি"] }, naogaon: { name: "নওগাঁ", upazilas: ["আত্রাই", "বদলগাছী", "ধামইরহাট", "মান্দা", "মহাদেবপুর", "নওগাঁ সদর", "নিয়ামতপুর", "পত্নীতলা", "পোরশা", "রানীনগর", "সাপাহার"] }, natore: { name: "নাটোর", upazilas: ["বাগাতিপাড়া", "বড়াইগ্রাম", "গুরুদাসপুর", "লালপুর", "নাটোর সদর", "সিংড়া", "নলডাঙ্গা"] }, pabna: { name: "পাবনা", upazilas: ["আটঘরিয়া", "বেড়া", "ভাঙ্গুড়া", "চাটমোহর", "ফরিদপুর", "ঈশ্বরদী", "পাবনা সদর", "সাঁথিয়া", "সুজানগর"] }, rajshahi: { name: "রাজশাহী", upazilas: ["বাঘা", "বাগমারা", "চারঘাট", "দুর্গাপুর", "গোদাগাড়ী", "মোহনপুর", "পবা", "পুঠিয়া", "তানোর", "রাজশাহী বিশ্ববিদ্যালয়"] }, sirajganj: { name: "সিরাজগঞ্জ", upazilas: ["বেলকুচি", "চৌহালী", "কামারখন্দ", "কাজীপুর", "রায়গঞ্জ", "শাহজাদপুর", "সিরাজগঞ্জ সদর", "তাড়াশ", "উল্লাপাড়া"] } } },
            rangpur: { name: "রংপুর", districts: { dinajpur: { name: "দিনাজপুর", upazilas: ["বিরামপুর", "বীরগঞ্জ", "বিরল", "বোচাগঞ্জ", "চিরিরবন্দর", "ফুলবাড়ী", "ঘোড়াঘাট", "হাকিমপুর", "কাহারোল", "খানসামা", "দিনাজপুর সদর", "নবাবগঞ্জ", "পার্বতীপুর"] }, gaibandha: { name: "গাইবান্ধা", upazilas: ["ফুলছড়ি", "গাইবান্ধা সদর", "গোবিন্দগঞ্জ", "পলাশবাড়ী", "সাদুল্লাপুর", "সাঘাটা", "সুন্দরগঞ্জ"] }, kurigram: { name: "কুড়িগ্রাম", upazilas: ["ভুরুঙ্গামারী", "চর রাজিবপুর", "চিলমারী", "ফুলবাড়ী", "কুড়িগ্রাম সদর", "নাগেশ্বরী", "রাজারহাট", "রৌমারী", "উলিপুর"] }, lalmonirhat: { name: "লালমনিরহাট", upazilas: ["আদিতমারী", "হাতীবান্ধা", "কালীগঞ্জ", "লালমনিরহাট সদর", "পাটগ্রাম"] }, nilphamari: { name: "নীলফামারী", upazilas: ["ডোমার", "ডিমলা", "জলঢাকা", "কিশোরগঞ্জ", "নীলফামারী সদর", "সৈয়দপুর"] }, panchagarh: { name: "পঞ্চগড়", upazilas: ["আটোয়ারী", "বোদা", "দেবীগঞ্জ", "পঞ্চগড় সদর", "তেঁতুলিয়া"] }, rangamati: { name: "রংপুর", upazilas: ["বদরগঞ্জ", "গঙ্গাচড়া", "কাউনিয়া", "রংপুর সদর", "মিঠাপুকুর", "পীরগাছা", "পীরগঞ্জ", "তারাগঞ্জ"] }, thakurgaon: { name: "ঠাকুরগাঁও", upazilas: ["বালিয়াডাঙ্গী", "হরিপুর", "পীরগঞ্জ", "রানীশংকৈল", "ঠাকুরগাঁও সদর"] } } },
            sylhet: { name: "সিলেট", districts: { habiganj: { name: "হবিগঞ্জ", upazilas: ["আজমিরীগঞ্জ", "বাহুবল", "বানিয়াচং", "চুনারুঘাট", "হবিগঞ্জ সদর", "লাখাই", "মাধবপুর", "নবীগঞ্জ", "শায়েস্তাগঞ্জ"] }, moulvibazar: { name: "মৌলভীবাজার", upazilas: ["বড়লেখা", "জুড়ী", "কমলগঞ্জ", "কুলাউড়া", "মৌলভীবাজার সদর", "রাজনগর", "শ্রীমঙ্গল"] }, sunamganj: { name: "সুনামগঞ্জ", upazilas: ["বিশ্বম্ভরপুর", "ছাতক", "দিরাই", "দোয়ারাবাজার", "জগন্নাথপুর", "জামালগঞ্জ", "শাল্লা", "সুনামগঞ্জ সদর", "তাহিরপুর", "ধর্মপাশা", "দক্ষিণ সুনামগঞ্জ", "মধ্যনগর"] }, sylhet: { name: "সিলেট", upazilas: ["বালাগঞ্জ", "বিয়ানীবাজার", "বিশ্বনাথ", "কোম্পানীগঞ্জ", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "গোয়াইনঘাট", "জৈন্তাপুর", "কানাইঘাট", "সিলেট সদর", "জকিগঞ্জ", "দক্ষিণ সুরমা", "ওসমানী নগর", "আম্বরখানা", "জিন্দাবাজার"] } } }
            };
            
            // 3. MOCK DONOR DATABASE (Simulated)
            const mockDonors = []; 

            // 4. DOM ELEMENTS - MAIN SEARCH
            const divisionSelect = document.getElementById('division');
            const districtSelect = document.getElementById('district');
            const upazilaSelect = document.getElementById('upazila');
            const searchForm = document.getElementById('searchForm');
            const searchView = document.getElementById('search-view-section');
            const resultsView = document.getElementById('results-view-section');
            const resultsGrid = document.getElementById('resultsGrid');
            const noResults = document.getElementById('noResults');
            const fabHint = document.getElementById('fabHint');
            
            // 5. DOM ELEMENTS - ADD CONTACT
            const addContactOverlay = document.getElementById('addContactOverlay');
            const closeAddContactBtn = document.getElementById('closeAddContactBtn');
            const editForm = document.getElementById('editForm');
            const editDivisionSelect = document.getElementById('editDivision');
            const editDistrictSelect = document.getElementById('editDistrict');
            const editUpazilaSelect = document.getElementById('editUpazila');
            const serviceTypeSelect = document.getElementById('serviceType');
            const saveBtn = document.getElementById('saveBtn');

            // --- HELPER FUNCTIONS FOR DROPDOWNS ---
            const populateDivisions = (selectElement) => {
                selectElement.innerHTML = '<option value="" disabled selected>বিভাগ নির্বাচন করুন</option>';
                for (const div in locationData) {
                    const option = document.createElement('option');
                    option.value = div;
                    option.textContent = locationData[div].name; 
                    selectElement.appendChild(option);
                }
            };

            const populateDistricts = (divKey, distSelect, upaSelect) => {
                distSelect.innerHTML = '<option value="" disabled selected>জেলা নির্বাচন করুন</option>';
                distSelect.disabled = true;
                if(upaSelect) {
                    upaSelect.innerHTML = '<option value="" disabled selected>প্রথমে জেলা নির্বাচন করুন</option>';
                    upaSelect.disabled = true;
                }

                if (divKey && locationData[divKey]) {
                    const districts = locationData[divKey].districts;
                    for (const key in districts) {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = districts[key].name; 
                        distSelect.appendChild(option);
                    }
                    distSelect.disabled = false;
                }
            };

            const populateUpazilas = (divKey, distKey, upaSelect) => {
                upaSelect.innerHTML = '<option value="" disabled selected>উপজেলা নির্বাচন করুন</option>';
                upaSelect.disabled = true;
                
                if (divKey && distKey && locationData[divKey].districts[distKey]) {
                    const upazilas = locationData[divKey].districts[distKey].upazilas;
                    upazilas.forEach(upa => {
                        const option = document.createElement('option');
                        option.value = upa; 
                        option.textContent = upa;
                        upaSelect.appendChild(option);
                    });
                    upaSelect.disabled = false;
                }
            };

            // INITIALIZE MAIN SEARCH DROPDOWNS
            populateDivisions(divisionSelect);

            divisionSelect.addEventListener('change', function() {
                populateDistricts(this.value, districtSelect, upazilaSelect);
            });
            districtSelect.addEventListener('change', function() {
                populateUpazilas(divisionSelect.value, this.value, upazilaSelect);
            });

            // INITIALIZE ADD CONTACT DROPDOWNS
            populateDivisions(editDivisionSelect);

            editDivisionSelect.addEventListener('change', function() {
                populateDistricts(this.value, editDistrictSelect, editUpazilaSelect);
                validateForm();
            });
            editDistrictSelect.addEventListener('change', function() {
                populateUpazilas(editDivisionSelect.value, this.value, editUpazilaSelect);
                validateForm();
            });

            // 6. SEARCH LOGIC
            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();

                // Store selected values globally
                currentSearchDiv = divisionSelect.value;
                currentSearchDist = districtSelect.value;
                currentSearchUpa = upazilaSelect.value;
                
                runSearchAndRender();
            });

            function runSearchAndRender() {
                // Step 1: Hide Search View
                searchView.style.display = 'none';

                // Filter Data
                const results = mockDonors.filter(donor => {
                    return donor.districtKey === currentSearchDist &&
                            (donor.upazila === currentSearchUpa || currentSearchUpa === ""); 
                });

                // Prepare Bangla names for Header and Location
                const divNameBn = locationData[currentSearchDiv].name;
                const distNameBn = locationData[currentSearchDiv].districts[currentSearchDist].name;

                // Header Update
                document.getElementById('resultHeaderTitle').textContent = `${currentServiceTitle} | ${currentSearchUpa}`;
                
                document.getElementById('searchCriteriaText').innerHTML = 
                    `<i class="fas fa-map-marker-alt"></i> ${currentSearchUpa}, ${distNameBn}, ${divNameBn}`;

                // Update No Result Text dynamically
                document.getElementById('dynamicNoResultType').textContent = currentServiceTitle;

                // Render Cards with Bangla Location
                renderCards(results, divNameBn, distNameBn);

                // Step 2: Show Results Instantly
                resultsView.style.display = 'block';
                window.scrollTo(0, 0);

                // Show FAB Hint for 3 seconds
                if(fabHint) {
                    setTimeout(() => { fabHint.classList.add('show'); }, 500);
                    setTimeout(() => { fabHint.classList.remove('show'); }, 3500);
                }
            }

            // COPY TO CLIPBOARD HELPER
            window.copyToClipboard = function(text) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('ই-মেইল কপি হয়েছে: ' + text);
                }).catch(err => {
                    console.error('Copy failed', err);
                });
            };

            // 7. RENDER CARDS
            function renderCards(data, divNameBn, distNameBn) {
                resultsGrid.innerHTML = '';
                if (data.length === 0) {
                    noResults.style.display = 'block';
                    return;
                }
                noResults.style.display = 'none';

                data.forEach(donor => {
                    const card = document.createElement('div');
                    card.className = 'emergency-card';
                    
                    // Logic to show Email Button only if email exists
                    const emailButton = (donor.email && donor.email.trim() !== "") 
                        ? `<button class="btn btn-sm btn-outline" onclick="copyToClipboard('${donor.email}')"><i class="fas fa-copy"></i> ই-মেইল</button>` 
                        : '';

                    card.innerHTML = `
                        <div class="e-card-top">
                            <div class="creator-info">
                                <span class="creator-name"><i class="fas fa-user-circle"></i> ${donor.name}</span>
                            </div>
                        </div>
                        <div class="e-details">
                            <h4>${donor.officeName}</h4>
                            <p><i class="fas fa-calendar-check"></i> শেষ আপডেট: ${donor.lastUpdate || 'সদ্য যুক্ত'}</p>
                            <p><i class="fas fa-map-marked-alt"></i> ${donor.upazila}, ${distNameBn}</p>
                        </div>
                        <div class="e-actions">
                            <button class="btn btn-sm btn-call" onclick="window.location.href='tel:${donor.mobile}'">
                                <i class="fas fa-phone-alt"></i> কল করুন
                            </button>
                            ${emailButton}
                        </div>
                    `;
                    resultsGrid.appendChild(card);
                });
            }

            // 8. UTILITIES (Sidebar Toggle)
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.sidebar-backdrop');
            const toggleBtn = document.querySelector('.sidebar-toggle');
            const closeBtn = document.querySelector('.sidebar-back-button');

            if(toggleBtn) {
                toggleBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    sidebar.classList.add('is-open');
                    backdrop.classList.add('is-open');
                });
            }
            const closeSidebar = () => {
                sidebar.classList.remove('is-open');
                backdrop.classList.remove('is-open');
            };
            if(closeBtn) closeBtn.addEventListener('click', closeSidebar);
            if(backdrop) backdrop.addEventListener('click', closeSidebar);

            // Dropdown Toggle Logic
            document.querySelectorAll(".dropdown-toggle").forEach((dropdownToggle) => {
              dropdownToggle.addEventListener("click", (e) => {
                e.preventDefault();
                const container = dropdownToggle.closest(".dropdown-container");
                const menu = container.querySelector(".dropdown-menu");
                const isOpen = container.classList.contains("open");
                
                container.classList.toggle("open", !isOpen);
                
                if (!isOpen) {
                    menu.style.height = `${menu.scrollHeight}px`;
                } else {
                    menu.style.height = "0";
                }
              });
            });

            // Theme Toggle Logic
            const themeToggle = document.getElementById('theme-toggle');
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            if(themeToggle) {
                themeToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
                });
            }

            window.resetSearch = function() {
                resultsView.style.display = 'none';
                searchView.style.display = 'block';
            };

            // 9. ADMIN FAB & PASSKEY LOGIC
            const adminFab = document.getElementById('adminFab');
            const passkeyOverlay = document.getElementById('passkeyOverlay');
            const passkeyForm = document.getElementById('passkeyForm');
            const passkeyInput = document.getElementById('passkey-input');
            const passkeyError = document.getElementById('passkey-error');
            const closePasskeyBtn = document.getElementById('closePasskeyBtn');
            const CORRECT_PASS_KEY = "123456"; 

            if(adminFab) {
                adminFab.addEventListener('click', () => {
                   passkeyOverlay.style.display = 'flex';
                });
            }

            if(closePasskeyBtn) {
                closePasskeyBtn.addEventListener('click', () => {
                    passkeyOverlay.style.display = 'none';
                    passkeyInput.value = '';
                    passkeyError.textContent = '';
                });
            }

            if(passkeyForm) {
                passkeyForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    if (passkeyInput.value === CORRECT_PASS_KEY) {
                        passkeyInput.value = '';
                        passkeyError.textContent = '';
                        passkeyOverlay.style.display = 'none'; // Close Passkey Overlay
                        
                        // OPEN ADD CONTACT OVERLAY
                        openAddContactOverlay();
                        
                    } else {
                        passkeyError.textContent = 'ভুল Pass Key! আবার চেষ্টা করুন।';
                        passkeyInput.value = '';
                        setTimeout(() => { passkeyError.textContent = ''; }, 3000);
                    }
                });
            }

            // 10. ADD CONTACT LOGIC
            
            function openAddContactOverlay() {
                // Pre-fill location based on search
                editDivisionSelect.value = currentSearchDiv;
                populateDistricts(currentSearchDiv, editDistrictSelect, editUpazilaSelect);
                editDistrictSelect.value = currentSearchDist;
                populateUpazilas(currentSearchDiv, currentSearchDist, editUpazilaSelect);
                editUpazilaSelect.value = currentSearchUpa;

                // Auto Select Service Section based on current search context
                // If header is "রক্তদাতা অনুসন্ধান", auto select that option
                const serviceOptions = serviceTypeSelect.options;
                for (let i = 0; i < serviceOptions.length; i++) {
                    if (serviceOptions[i].value === currentServiceTitle) {
                        serviceTypeSelect.selectedIndex = i;
                        break;
                    }
                }

                validateForm();
                addContactOverlay.style.display = 'flex';
            }

            closeAddContactBtn.addEventListener('click', () => {
                addContactOverlay.style.display = 'none';
                document.getElementById('editForm').reset();
            });

            // Form Validation Logic
            const personNameInput = document.getElementById('personName');
            const officeNameInput = document.getElementById('officeName');
            const mobileNumberInput = document.getElementById('mobileNumber');
            const emailAddressInput = document.getElementById('emailAddress');

            const allInputs = [serviceTypeSelect, editDivisionSelect, editDistrictSelect, editUpazilaSelect, personNameInput, officeNameInput, mobileNumberInput, emailAddressInput];
            allInputs.forEach(input => input.addEventListener('input', validateForm));
            allInputs.forEach(select => select.addEventListener('change', validateForm));

            function validateForm() {
                const isContactInfoEntered = mobileNumberInput.value.trim() !== "" || emailAddressInput.value.trim() !== "";
                saveBtn.disabled = !(serviceTypeSelect.value && editDivisionSelect.value && editDistrictSelect.value && editUpazilaSelect.value && officeNameInput.value.trim() && isContactInfoEntered);
            }

            // Handle New Contact Save
            editForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (saveBtn.disabled) return;

                const newDonor = {
                    id: Date.now(), // Fake ID
                    serviceType: serviceTypeSelect.value,
                    name: personNameInput.value || "নাম নেই",
                    officeName: officeNameInput.value,
                    mobile: mobileNumberInput.value,
                    email: emailAddressInput.value, // Added Email Saving Logic
                    divisionKey: editDivisionSelect.value,
                    districtKey: editDistrictSelect.value,
                    upazila: editUpazilaSelect.value,
                    lastUpdate: new Date().toLocaleDateString('bn-BD')
                };

                // Add to Mock Database
                mockDonors.push(newDonor);

                // Close Overlay
                addContactOverlay.style.display = 'none';
                
                // Clear Form
                editForm.reset();

                // Show Alert
                alert("তথ্য সফলভাবে যোগ করা হয়েছে!");

                // Re-render Search Results
                runSearchAndRender();
            });

        });
    </script>
</body>
</html>